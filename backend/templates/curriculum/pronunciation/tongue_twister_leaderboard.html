{% extends "base/_base_public.html" %}
{% load static %}

{% block title %}Bảng xếp hạng xoắn lưỡi - EnglishMaster{% endblock %}

{% block extra_css %}
<style>
    .leaderboard-hero {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 3rem 0;
    }
    
    .twister-card {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    
    .top-performer-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.06);
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .rank-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 700;
    }
    
    .rank-1 { background: linear-gradient(135deg, #FFD700, #FFA500); color: white; }
    .rank-2 { background: linear-gradient(135deg, #C0C0C0, #A9A9A9); color: white; }
    .rank-3 { background: linear-gradient(135deg, #CD7F32, #8B4513); color: white; }
    .rank-other { background: #E0E6ED; color: #183B56; }
</style>
{% endblock %}

{% block content %}
<div class="leaderboard-hero">
    <div class="container">
        <h1 class="display-5 fw-bold text-center mb-2">
            <i class="fas fa-trophy me-3"></i>
            Bảng xếp hạng xoắn lưỡi
        </h1>
        <p class="lead text-center mb-0">Những người chơi xuất sắc nhất</p>
    </div>
</div>

<div class="container py-5">
    <div class="row">
        <!-- Top Performers -->
        <div class="col-lg-8">
            <h3 class="fw-bold mb-4">
                <i class="fas fa-star text-warning me-2"></i>
                Top 20 người chơi xuất sắc
            </h3>
            
            {% for performer in top_performers %}
            <div class="top-performer-card">
                <div class="rank-circle {% if forloop.counter <= 3 %}rank-{{ forloop.counter }}{% else %}rank-other{% endif %}">
                    {{ forloop.counter }}
                </div>
                <div class="flex-grow-1">
                    <h5 class="mb-1">
                        {{ performer.user__first_name }} {{ performer.user__last_name }}
                        {% if not performer.user__first_name %}{{ performer.user__username }}{% endif %}
                    </h5>
                    <small class="text-muted">{{ performer.total_attempts }} lần thử</small>
                </div>
                <div class="text-end">
                    <div class="h4 mb-0 text-primary">{{ performer.avg_score|floatformat:0 }}</div>
                    <small class="text-muted">điểm TB</small>
                </div>
            </div>
            {% empty %}
            <div class="text-center text-muted py-5">
                <i class="fas fa-users fa-3x mb-3"></i>
                <p>Chưa có người chơi nào. Hãy là người đầu tiên!</p>
            </div>
            {% endfor %}
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Recent Activity -->
            <div class="twister-card">
                <h5 class="fw-bold mb-3">
                    <i class="fas fa-clock text-info me-2"></i>
                    Hoạt động gần đây
                </h5>
                {% for attempt in recent_attempts %}
                <div class="d-flex align-items-center mb-3 pb-3 border-bottom">
                    <div class="flex-grow-1">
                        <div class="fw-bold">{{ attempt.user.get_full_name|default:attempt.user.username }}</div>
                        <small class="text-muted">{{ attempt.created_at|timesince }} trước</small>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-primary">{{ attempt.score|floatformat:0 }}</span>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted">Chưa có hoạt động nào</p>
                {% endfor %}
            </div>
            
            <!-- All Twisters -->
            <div class="twister-card mt-4">
                <h5 class="fw-bold mb-3">
                    <i class="fas fa-list text-success me-2"></i>
                    Tất cả tongue twisters
                </h5>
                {% for twister in twisters %}
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="fw-bold">{{ twister.text|truncatewords:5 }}</div>
                            <small class="text-muted">{{ twister.attempt_count }} lần thử</small>
                        </div>
                        <a href="{% url 'curriculum:tongue-twister-challenge' %}?id={{ twister.id }}" class="btn btn-sm btn-outline-primary">
                            Thử
                        </a>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted">Chưa có tongue twister nào</p>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <div class="text-center mt-5">
        <a href="{% url 'curriculum:tongue-twister-challenge' %}" class="btn btn-lg btn-primary">
            <i class="fas fa-gamepad me-2"></i>
            Bắt đầu thử thách
        </a>
    </div>
</div>
{% endblock %}
