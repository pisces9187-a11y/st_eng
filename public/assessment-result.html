<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K·∫øt qu·∫£ b√†i ki·ªÉm tra</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Custom Theme CSS -->
    <link rel="stylesheet" href="assets/css/theme.css">
    
    <style>
        .circular-chart {
            max-width: 200px;
        }
        
        .circle-bg {
            fill: none;
            stroke: #E0E6ED;
            stroke-width: 3.8;
        }
        
        .circle {
            fill: none;
            stroke-width: 3.8;
            stroke-linecap: round;
            animation: progress 1s ease-out forwards;
        }
        
        .circle.orange {
            stroke: #F47C26;
        }
        
        @keyframes progress {
            0% {
                stroke-dasharray: 0 100;
            }
        }
        
        .mw-600 {
            max-width: 600px;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes countUp {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
    </style>
</head>
<body class="bg-light">
    <div id="app">
        <div class="container py-5">
            <div class="text-center py-5 fade-in-up">
                <!-- Circular Progress Chart -->
                <div class="position-relative d-inline-block mb-4">
                    <svg viewBox="0 0 36 36" class="circular-chart orange" style="width: 200px; height: 200px;">
                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" :stroke-dasharray="score + ', 100'" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                    </svg>
                    <div class="position-absolute top-50 start-50 translate-middle">
                        <h1 class="display-3 fw-bold text-secondary mb-0">{{ displayScore }}</h1>
                        <span class="text-muted text-uppercase small">Points</span>
                    </div>
                </div>

                <!-- Result Message -->
                <h2 class="fw-bold mb-3" :class="resultClass">
                    {{ resultMessage }} {{ resultEmoji }}
                </h2>
                <p class="text-muted mw-600 mx-auto mb-5">
                    {{ resultDescription }}
                </p>

                <!-- Statistics Cards -->
                <div class="row justify-content-center g-4 mb-5">
                    <div class="col-auto">
                        <div class="card border-0 shadow-sm p-3 text-center">
                            <div class="text-muted small">Th·ªùi gian</div>
                            <div class="fw-bold fs-5">{{ timeUsed }}</div>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="card border-0 shadow-sm p-3 text-center">
                            <div class="text-muted small">ƒê·ªô ch√≠nh x√°c</div>
                            <div class="fw-bold fs-5 text-success">{{ score }}%</div>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="card border-0 shadow-sm p-3 text-center">
                            <div class="text-muted small">C√¢u ƒë√∫ng</div>
                            <div class="fw-bold fs-5 text-primary">{{ correctAnswers }}/{{ totalQuestions }}</div>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="card border-0 shadow-sm p-3 text-center">
                            <div class="text-muted small">XP nh·∫≠n ƒë∆∞·ª£c</div>
                            <div class="fw-bold fs-5 text-warning">+{{ xpEarned }} XP</div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex gap-3 justify-content-center flex-wrap">
                    <button class="btn btn-primary btn-lg shadow px-5 rounded-pill" @click="continueToNextLevel" v-if="isPassed">
                        <i class="fas fa-rocket me-2"></i>V√ÄO H·ªåC LEVEL TI·∫æP THEO
                    </button>
                    <button class="btn btn-outline-primary btn-lg px-5 rounded-pill" @click="reviewAnswers">
                        <i class="fas fa-search me-2"></i>Xem l·∫°i ƒë√°p √°n
                    </button>
                    <button class="btn btn-outline-secondary btn-lg px-5 rounded-pill" @click="retakeTest" v-if="!isPassed">
                        <i class="fas fa-redo me-2"></i>L√†m l·∫°i b√†i ki·ªÉm tra
                    </button>
                </div>

                <!-- Back to Dashboard -->
                <div class="mt-5">
                    <a href="dashboard.html" class="btn btn-outline-secondary">
                        <i class="fas fa-home me-2"></i>Quay l·∫°i Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    score: 0,
                    displayScore: 0,
                    correctAnswers: 0,
                    totalQuestions: 0,
                    timeUsed: '12:30',
                    xpEarned: 0
                }
            },
            computed: {
                isPassed() {
                    return this.score >= 70;
                },
                resultMessage() {
                    if (this.score >= 90) return 'Xu·∫•t s·∫Øc! B·∫°n ƒë√£ th√†nh th·∫°o Level A2';
                    if (this.score >= 80) return 'Tuy·ªát v·ªùi! B·∫°n ƒë√£ ƒë·ªó Level A2';
                    if (this.score >= 70) return 'Ch√∫c m·ª´ng! B·∫°n ƒë√£ v∆∞·ª£t qua Level A2';
                    if (this.score >= 60) return 'G·∫ßn r·ªìi! H√£y c·ªë g·∫Øng th√™m ch√∫t n·ªØa';
                    return 'ƒê·ª´ng n·∫£n l√≤ng! H√£y √¥n t·∫≠p v√† th·ª≠ l·∫°i';
                },
                resultEmoji() {
                    if (this.score >= 90) return 'üéâ';
                    if (this.score >= 80) return 'üåü';
                    if (this.score >= 70) return '‚ú®';
                    if (this.score >= 60) return 'üí™';
                    return 'üìö';
                },
                resultClass() {
                    if (this.score >= 70) return 'text-primary';
                    return 'text-warning';
                },
                resultDescription() {
                    if (this.score >= 90) {
                        return 'B·∫°n ƒë√£ n·∫Øm v·ªØng ho√†n to√†n c√°c ki·∫øn th·ª©c v·ªÅ th√¨ Qu√° kh·ª© ƒë∆°n, C√¢u gh√©p v√† c·∫•u tr√∫c c√¢u c∆° b·∫£n. L·ªô tr√¨nh B1 ƒë√£ ƒë∆∞·ª£c m·ªü kh√≥a!';
                    }
                    if (this.score >= 70) {
                        return 'B·∫°n ƒë√£ ƒë·∫°t y√™u c·∫ßu ƒë·ªÉ chuy·ªÉn sang Level B1. H√£y ti·∫øp t·ª•c ph√°t huy!';
                    }
                    return 'B·∫°n c·∫ßn √¥n t·∫≠p th√™m m·ªôt s·ªë ph·∫ßn ƒë·ªÉ ho√†n thi·ªán ki·∫øn th·ª©c Level A2.';
                }
            },
            methods: {
                animateScore() {
                    const duration = 1500;
                    const steps = 60;
                    const increment = this.score / steps;
                    let current = 0;
                    
                    const timer = setInterval(() => {
                        current += increment;
                        if (current >= this.score) {
                            this.displayScore = this.score;
                            clearInterval(timer);
                        } else {
                            this.displayScore = Math.floor(current);
                        }
                    }, duration / steps);
                },
                continueToNextLevel() {
                    alert('Ch√∫c m·ª´ng! B·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn sang Level B1.');
                    window.location.href = 'dashboard.html';
                },
                reviewAnswers() {
                    alert('T√≠nh nƒÉng xem l·∫°i ƒë√°p √°n ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn.');
                },
                retakeTest() {
                    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën l√†m l·∫°i b√†i ki·ªÉm tra?')) {
                        window.location.href = 'assessment.html';
                    }
                },
                getResultFromURL() {
                    const urlParams = new URLSearchParams(window.location.search);
                    this.score = parseInt(urlParams.get('score')) || 85;
                    this.correctAnswers = parseInt(urlParams.get('correct')) || 17;
                    this.totalQuestions = parseInt(urlParams.get('total')) || 20;
                    
                    // Calculate XP based on score
                    this.xpEarned = Math.round(this.score * 2.5);
                    
                    // Calculate time used (random for demo)
                    const minutes = Math.floor(Math.random() * 5) + 10;
                    const seconds = Math.floor(Math.random() * 60);
                    this.timeUsed = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
            },
            mounted() {
                this.getResultFromURL();
                this.animateScore();
            }
        }).mount('#app');
    </script>
</body>
</html>
