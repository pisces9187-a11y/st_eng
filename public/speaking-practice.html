<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyện nói - English Learning Platform</title>
    
    <!-- Bootstrap 5.3.0 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome 6.4.0 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts: Montserrat + Open Sans -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Custom Theme CSS -->
    <link rel="stylesheet" href="../assets/css/theme.css">
    
    <style>
        body {
            background: #F9FAFC;
            font-family: 'Open Sans', sans-serif;
        }
        
        .speaking-container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 0 20px;
        }
        
        /* Header */
        .speaking-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .speaking-header h1 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            color: #183B56;
            margin-bottom: 12px;
        }
        
        /* Practice Card */
        .practice-card {
            background: white;
            padding: 48px;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            margin-bottom: 32px;
        }
        
        /* Prompt Section */
        .prompt-section {
            text-align: center;
            margin-bottom: 48px;
        }
        
        .prompt-icon {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #F47C26 0%, #FFA500 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            box-shadow: 0 4px 20px rgba(244, 124, 38, 0.3);
        }
        
        .prompt-icon i {
            font-size: 3rem;
            color: white;
        }
        
        .prompt-text {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.75rem;
            font-weight: 700;
            color: #183B56;
            line-height: 1.6;
            margin-bottom: 16px;
        }
        
        .prompt-translation {
            color: #57606F;
            font-size: 1.125rem;
            font-style: italic;
        }
        
        /* Recording Controls */
        .recording-controls {
            text-align: center;
            margin: 48px 0;
        }
        
        .record-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #F47C26 0%, #FFA500 100%);
            color: white;
            font-size: 3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(244, 124, 38, 0.4);
            position: relative;
        }
        
        .record-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 24px rgba(244, 124, 38, 0.5);
        }
        
        .record-btn.recording {
            background: #E74C3C;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .recording-status {
            margin-top: 24px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.125rem;
            color: #57606F;
        }
        
        .recording-status.active {
            color: #E74C3C;
        }
        
        .recording-timer {
            font-size: 2rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            color: #E74C3C;
            margin-top: 16px;
        }
        
        /* Waveform Visualization */
        .waveform-container {
            height: 100px;
            background: #F9FAFC;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 20px;
            margin: 32px 0;
        }
        
        .waveform-bar {
            width: 4px;
            background: #F47C26;
            border-radius: 2px;
            transition: height 0.1s ease;
        }
        
        /* Playback Section */
        .playback-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 48px;
        }
        
        .audio-player {
            background: #F9FAFC;
            padding: 24px;
            border-radius: 12px;
            text-align: center;
        }
        
        .audio-player h3 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            color: #183B56;
            margin-bottom: 20px;
            font-size: 1.125rem;
        }
        
        .play-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: #183B56;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .play-btn:hover {
            background: #F47C26;
            transform: scale(1.05);
        }
        
        .play-btn.active {
            background: #F47C26;
        }
        
        /* Scoring */
        .score-section {
            background: linear-gradient(135deg, #183B56 0%, #2C5F8D 100%);
            padding: 32px;
            border-radius: 12px;
            color: white;
            text-align: center;
            margin-top: 32px;
        }
        
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            position: relative;
        }
        
        .score-number {
            font-size: 3rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            color: #F47C26;
        }
        
        .score-label {
            font-size: 1.125rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            margin-bottom: 24px;
        }
        
        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 32px;
        }
        
        .score-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 16px;
            border-radius: 8px;
        }
        
        .score-item-value {
            font-size: 1.5rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .score-item-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        /* Feedback */
        .feedback-section {
            background: #FFF4E5;
            border: 2px solid #F39C12;
            padding: 24px;
            border-radius: 12px;
            margin-top: 32px;
        }
        
        .feedback-section h4 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            color: #F39C12;
            margin-bottom: 16px;
        }
        
        .feedback-section ul {
            margin: 0;
            padding-left: 24px;
        }
        
        .feedback-section li {
            margin-bottom: 8px;
            line-height: 1.6;
            color: #2C3E50;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 32px;
        }
        
        .btn-action {
            padding: 14px 32px;
            border: none;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary-action {
            background: #F47C26;
            color: white;
        }
        
        .btn-primary-action:hover {
            background: #D35400;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(244, 124, 38, 0.3);
        }
        
        .btn-secondary-action {
            background: #2ECC71;
            color: white;
        }
        
        .btn-secondary-action:hover {
            background: #27AE60;
        }
        
        .btn-tertiary-action {
            background: #E0E6ED;
            color: #57606F;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .playback-section {
                grid-template-columns: 1fr;
            }
            
            .score-breakdown {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="speaking-container">
            <!-- Header -->
            <div class="speaking-header">
                <h1><i class="fas fa-microphone-alt me-3"></i>Luyện nói tiếng Anh</h1>
                <p class="text-muted">Cải thiện khả năng phát âm và giao tiếp</p>
            </div>

            <!-- Practice Card -->
            <div class="practice-card">
                <!-- Prompt Section -->
                <div class="prompt-section">
                    <div class="prompt-icon">
                        <i class="fas fa-comment-dots"></i>
                    </div>
                    <div class="prompt-text">{{ currentPrompt.text }}</div>
                    <div class="prompt-translation">{{ currentPrompt.translation }}</div>
                </div>

                <!-- Recording Controls -->
                <div class="recording-controls">
                    <button 
                        class="record-btn" 
                        :class="{recording: isRecording}"
                        @click="toggleRecording"
                    >
                        <i :class="isRecording ? 'fas fa-stop' : 'fas fa-microphone'"></i>
                    </button>
                    <div class="recording-status" :class="{active: isRecording}">
                        {{ isRecording ? 'Đang ghi âm...' : (hasRecording ? 'Đã hoàn thành' : 'Nhấn để bắt đầu') }}
                    </div>
                    <div v-if="isRecording" class="recording-timer">{{ formattedTime }}</div>
                </div>

                <!-- Waveform Visualization -->
                <div v-if="isRecording" class="waveform-container">
                    <div 
                        v-for="i in 30" 
                        :key="i"
                        class="waveform-bar"
                        :style="{height: waveformHeights[i] + 'px'}"
                    ></div>
                </div>

                <!-- Playback Section -->
                <div v-if="hasRecording" class="playback-section">
                    <div class="audio-player">
                        <h3><i class="fas fa-volume-up me-2"></i>Giọng chuẩn</h3>
                        <button class="play-btn" :class="{active: playingNative}" @click="playNative">
                            <i :class="playingNative ? 'fas fa-pause' : 'fas fa-play'"></i>
                        </button>
                    </div>
                    <div class="audio-player">
                        <h3><i class="fas fa-user me-2"></i>Giọng của bạn</h3>
                        <button class="play-btn" :class="{active: playingUser}" @click="playUser">
                            <i :class="playingUser ? 'fas fa-pause' : 'fas fa-play'"></i>
                        </button>
                    </div>
                </div>

                <!-- Scoring -->
                <div v-if="showScore" class="score-section">
                    <div class="score-circle">
                        <div class="score-number">{{ overallScore }}</div>
                    </div>
                    <div class="score-label">Điểm tổng thể</div>
                    
                    <div class="score-breakdown">
                        <div class="score-item">
                            <div class="score-item-value">{{ pronunciationScore }}</div>
                            <div class="score-item-label">Phát âm</div>
                        </div>
                        <div class="score-item">
                            <div class="score-item-value">{{ fluencyScore }}</div>
                            <div class="score-item-label">Trôi chảy</div>
                        </div>
                        <div class="score-item">
                            <div class="score-item-value">{{ intonationScore }}</div>
                            <div class="score-item-label">Ngữ điệu</div>
                        </div>
                    </div>
                </div>

                <!-- Feedback -->
                <div v-if="showScore" class="feedback-section">
                    <h4><i class="fas fa-lightbulb me-2"></i>Gợi ý cải thiện</h4>
                    <ul>
                        <li v-for="(tip, index) in feedbackTips" :key="index">{{ tip }}</li>
                    </ul>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button v-if="hasRecording && !showScore" class="btn-action btn-primary-action" @click="analyze">
                        <i class="fas fa-chart-line me-2"></i>Phân tích
                    </button>
                    <button v-if="showScore" class="btn-action btn-secondary-action" @click="nextPrompt">
                        <i class="fas fa-arrow-right me-2"></i>Câu tiếp theo
                    </button>
                    <button v-if="hasRecording" class="btn-action btn-tertiary-action" @click="reset">
                        <i class="fas fa-redo me-2"></i>Thử lại
                    </button>
                </div>
            </div>

            <!-- Tips Section -->
            <div class="practice-card" style="background: linear-gradient(135deg, #F9FAFC 0%, #FFFFFF 100%);">
                <h3 class="mb-4" style="font-family: 'Montserrat', sans-serif; font-weight: 700; color: #183B56;">
                    <i class="fas fa-info-circle me-2"></i>Mẹo luyện nói hiệu quả
                </h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="d-flex gap-3">
                            <i class="fas fa-check-circle fa-2x" style="color: #F47C26;"></i>
                            <div>
                                <strong>Nói chậm và rõ ràng</strong>
                                <p class="text-muted mb-0">Không cần nói nhanh, quan trọng là phát âm chính xác</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="d-flex gap-3">
                            <i class="fas fa-headphones fa-2x" style="color: #F47C26;"></i>
                            <div>
                                <strong>Nghe và bắt chước</strong>
                                <p class="text-muted mb-0">So sánh giọng của bạn với giọng chuẩn</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="d-flex gap-3">
                            <i class="fas fa-redo fa-2x" style="color: #F47C26;"></i>
                            <div>
                                <strong>Lặp lại nhiều lần</strong>
                                <p class="text-muted mb-0">Thực hành mỗi ngày 15-20 phút</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="d-flex gap-3">
                            <i class="fas fa-microphone-alt fa-2x" style="color: #F47C26;"></i>
                            <div>
                                <strong>Ghi âm và nghe lại</strong>
                                <p class="text-muted mb-0">Nhận ra lỗi phát âm của mình</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- App Logic -->
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    isRecording: false,
                    hasRecording: false,
                    showScore: false,
                    playingNative: false,
                    playingUser: false,
                    recordingTime: 0,
                    recordingInterval: null,
                    waveformInterval: null,
                    waveformHeights: [],
                    overallScore: 85,
                    pronunciationScore: 82,
                    fluencyScore: 88,
                    intonationScore: 85,
                    feedbackTips: [
                        'Phát âm từ "introduce" cần nhấn mạnh vào âm tiết thứ ba: in-tro-DUCE',
                        'Cải thiện ngữ điệu bằng cách tăng giọng ở cuối câu hỏi',
                        'Giữ nhịp nói đều đặn hơn, tránh ngừng quá lâu giữa các từ',
                        'Rất tốt! Tiếp tục thực hành với các câu dài hơn'
                    ],
                    prompts: [
                        {
                            text: 'Hello, my name is John. Nice to meet you.',
                            translation: 'Xin chào, tên tôi là John. Rất vui được gặp bạn.'
                        },
                        {
                            text: 'I am learning English every day.',
                            translation: 'Tôi học tiếng Anh mỗi ngày.'
                        },
                        {
                            text: 'How are you doing today?',
                            translation: 'Hôm nay bạn thế nào?'
                        },
                        {
                            text: 'I would like to order a coffee, please.',
                            translation: 'Tôi muốn gọi một ly cà phê, làm ơn.'
                        }
                    ],
                    currentPromptIndex: 0,
                    mediaRecorder: null,
                    audioChunks: []
                };
            },
            computed: {
                currentPrompt() {
                    return this.prompts[this.currentPromptIndex];
                },
                formattedTime() {
                    const minutes = Math.floor(this.recordingTime / 60);
                    const seconds = this.recordingTime % 60;
                    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
            },
            methods: {
                async toggleRecording() {
                    if (!this.isRecording) {
                        await this.startRecording();
                    } else {
                        this.stopRecording();
                    }
                },
                async startRecording() {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        this.mediaRecorder = new MediaRecorder(stream);
                        this.audioChunks = [];
                        
                        this.mediaRecorder.ondataavailable = (event) => {
                            this.audioChunks.push(event.data);
                        };
                        
                        this.mediaRecorder.onstop = () => {
                            const audioBlob = new Blob(this.audioChunks, { type: 'audio/wav' });
                            // In production: Send to backend for analysis
                        };
                        
                        this.mediaRecorder.start();
                        this.isRecording = true;
                        this.hasRecording = false;
                        this.showScore = false;
                        this.recordingTime = 0;
                        
                        // Timer
                        this.recordingInterval = setInterval(() => {
                            this.recordingTime++;
                        }, 1000);
                        
                        // Waveform animation
                        this.waveformHeights = Array(30).fill(20);
                        this.waveformInterval = setInterval(() => {
                            this.waveformHeights = this.waveformHeights.map(() => 
                                Math.random() * 60 + 20
                            );
                        }, 100);
                        
                    } catch (error) {
                        alert('Không thể truy cập microphone. Vui lòng cấp quyền truy cập.');
                        console.error(error);
                    }
                },
                stopRecording() {
                    if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {
                        this.mediaRecorder.stop();
                        this.mediaRecorder.stream.getTracks().forEach(track => track.stop());
                    }
                    
                    this.isRecording = false;
                    this.hasRecording = true;
                    
                    clearInterval(this.recordingInterval);
                    clearInterval(this.waveformInterval);
                },
                playNative() {
                    this.playingNative = !this.playingNative;
                    if (this.playingNative) {
                        // Web Speech API for native pronunciation
                        const utterance = new SpeechSynthesisUtterance(this.currentPrompt.text);
                        utterance.lang = 'en-US';
                        utterance.rate = 0.9;
                        utterance.onend = () => {
                            this.playingNative = false;
                        };
                        window.speechSynthesis.speak(utterance);
                    } else {
                        window.speechSynthesis.cancel();
                    }
                },
                playUser() {
                    this.playingUser = !this.playingUser;
                    // In production: Play recorded audio
                    setTimeout(() => {
                        this.playingUser = false;
                    }, 3000);
                },
                analyze() {
                    // Simulate analysis
                    this.overallScore = Math.floor(Math.random() * 20) + 75;
                    this.pronunciationScore = Math.floor(Math.random() * 20) + 70;
                    this.fluencyScore = Math.floor(Math.random() * 20) + 75;
                    this.intonationScore = Math.floor(Math.random() * 20) + 75;
                    this.showScore = true;
                    
                    // In production: Send audio to backend API for real analysis
                },
                reset() {
                    this.hasRecording = false;
                    this.showScore = false;
                    this.recordingTime = 0;
                },
                nextPrompt() {
                    this.currentPromptIndex = (this.currentPromptIndex + 1) % this.prompts.length;
                    this.reset();
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
